<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>成績表</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>クイズ成績表</h1>
    <table id="resultsTable" border="1">
        <thead>
            <tr>
                <th>プレイヤー名</th>
                <th>スコア</th>
                <th>答えた問題</th>
            </tr>
        </thead>
        <tbody>
            <!-- 成績データがここに表示されます -->
        </tbody>
    </table>
    <button id="backToHome">ホームへ戻る</button>
    <button id="viewFriends">フレンドリスト</button>

    <script>
        // ホームに戻るボタンの処理
        document.getElementById("backToHome").addEventListener("click", () => {
            window.location.href = "/home";
        });

        // フレンド画面に移動する処理
        document.getElementById("viewFriends").addEventListener("click", () => {
            window.location.href = "/friend.html";
        });

        // 成績データを取得して表示する
        async function loadResults() {
    const roomName = localStorage.getItem("currentRoom");
    if (!roomName) {
        alert("ルーム名が設定されていません。");
        return;
    }

    try {
        const response = await fetch(`/quiz-results-history?roomName=${roomName}`);
        const result = await response.json();

        if (result.success) {
            displayResults(result.history);
        } else {
            alert(result.message || "成績データの取得に失敗しました。");
        }
    } catch (error) {
        console.error("成績データの取得中にエラーが発生しました:", error);
    }
}

function displayResults(history) {
    const tbody = document.getElementById("resultsTable").querySelector("tbody");
    tbody.innerHTML = "";

    history.forEach((quiz, index) => {
        const headerRow = document.createElement("tr");
        headerRow.innerHTML = `<td colspan="3"><strong>クイズ ${index + 1}</strong></td>`;
        tbody.appendChild(headerRow);

        quiz.forEach(({ playerName, score, answers }) => {
            const row = document.createElement("tr");

            row.innerHTML = `<td>${playerName}</td><td>${score}</td>`;

            const answerCell = document.createElement("td");
            const answerList = answers.map(({ question, answer, correct }) => {
                return `
                    <p>${question} - あなたの回答: ${answer} (${correct ? "正解" : "不正解"})</p>
                `;
            }).join("");

            answerCell.innerHTML = answerList;
            row.appendChild(answerCell);

            tbody.appendChild(row);
        });
    });
}

// ページロード時に履歴を取得
loadResults();

      
    </script>
</body>
</html>
